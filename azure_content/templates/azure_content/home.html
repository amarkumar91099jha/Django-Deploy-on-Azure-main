{% extends "azure_content/base.html" %}
{% load static %}
{% block content%}

  <div class="holder"> 
       <form method="GET">
        <div class="boxenholder2">

             <div class="factbox2">
                 <div class="factbox-title"> 
                    Start New Survey
                </div>
                <div class="factbox-fact"> 
                    <a class="iconcolor" href="{% url 'create-views'%}"> <i class="fas fa-plus-circle" style="color: #6F53E5;"></i> </a>
                </div>
            </div>

            <div class="factbox2">
                <div class="factbox-title"> 
                    <i class="fas fa-project-diagram mr-2"></i> # entries
                </div>
                <div class="factbox-fact" style="color: #6F53E5;"> 
                    {{ project_list|length }}
                </div>
            </div>

            <div class="factbox2">
                <div class="factbox-title" > 
                    <i class="fas fa-chart-line mr-2"></i> Channel
                </div>
                <div class="factbox-fact" style="color: #6F53E5;"> 
                 Amar Kumar
                </div>
            </div>


            <div class="factbox2">
                 <div class="factbox-title"> 
                   <i class="fas fa-times-circle mr-2"></i> Go to the about page
                </div>
                <div class="factbox-fact"> 
                    <a href="{% url 'about'%}"> <i class="fas fa-play" style="color: #6F53E5;"></i></a>
                </div>
            </div>

            

        </div>
        
        <div class="shadowholder">
            <div class="subtitel2"> 
                <div style="color: #6F53E5;"> <i class="fas fa-sticky-note" style="color: #6F53E5;"></i> My data </div>
            </div>
                <div class="content mb-3"> 
                    <table id="example5" class="beheertable" style="width:100% ">
                        <thead>
                            <tr style="color: #6F53E5;">
                                <th>ID</th>                             
                                <th>Address</th>
                                <th>Description</th>
                                <th>Created at</th>
                                <th>Edited at</th>
                                
                                
                            </tr>
                        </thead>

                        <tbody>
                             {%for a in project_list%}
                                <tr>
                                    <td style="color: #6F53E5;">{{a.id}}</td>                                   
                                    <td> {{a.address}} </td>
                                    <td style="color: #6F53E5;"><a style="color:#6F53E5;" href="{% url 'details' a.id%}">Details</a></td>
                                    <td> {{a.created_at|date:'d-m-Y H:i'}}</td>
                                    <td> {{a.updated_at|date:'d-m-Y H:i'}}</td>
                                </tr>
                             {%endfor%}

                        <tbody>
                        
                        
                    </table>
                </div>
        </div>
        <div class="card" id="map-container" style="margin-top:10px">
            <div class="card-body p-0">
                <div id="map" style="height:620px;"></div>
                <div class="sticky-container"style="margin-left:40px;">
                    {% comment %} <a href="{% url "location-views" %}" class="btn bg-purple btn-block mb-2">Start Survey</a>
                    <a hidden href="#" class="btn btn-secondary btn-block">Register for training</a> {% endcomment %}
                </div>
            </div>
        </div>

        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>

        
        <script>
            // Initialize the map
            // Initialize map
          var map = L.map('map').setView([28.6195, 77.3149], 5);
          
          // Base layers
          var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              attribution: '© OpenStreetMap contributors'
          });
          
          var satelliteLayer = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
              maxZoom: 20,
              subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
              attribution: '© Google contributors'
          }).addTo(map);
          
          // Feature group for markers
          var markerGroup = L.featureGroup().addTo(map);
          
          // Marker cluster group
          var markers = L.markerClusterGroup().addTo(map);
          
          // Layer group for polygons
          var polygonGroup = L.layerGroup();
          
          // Initialize marker and polygon variables
          var marker, polygon;
          var polygonCoords=[[]];
          
          // Add markers and polygons from addresses data
          var addresses = JSON.parse('{{ address | escapejs }}');
          console.log(addresses)
          addresses.forEach(function(address) {
              var popupContent = `
                  <div>
                      <h2>ID: ${address.id}</h2>
                      <p>Address: ${address.address}</p>
                  </div>
              `;
              let cord=[address.latitude, address.longitude];
              polygonCoords[0].push(cord);
              marker = L.marker([address.latitude, address.longitude]).bindPopup(popupContent);
              {% comment %} markerGroup.addLayer(marker); {% endcomment %}
              markers.addLayer(marker);
          });
          
          // Add polygons
          // Example polygons, replace with your own data
          {% comment %} var polygonCoords = [
              [[51.5, -0.1], [51.51, -0.06], [51.52, -0.1]],
              [[51.49, -0.06], [51.5, -0.1], [51.51, -0.06]]
          ]; {% endcomment %}
          
          polygonCoords.forEach(function(coords) {
              polygon = L.polygon(coords).bindPopup('Polygon');
              polygonGroup.addLayer(polygon);
          });
          
          // Overlay layers
          var overlayLayers = {
              'Marker Clusters': markers,
              'Polygons': polygonGroup
          };
          
          // Base layers
          var baseLayers = {
              'OpenStreetMap': osmLayer,
              'Satellite': satelliteLayer
          };
          
          // Add layers control
          L.control.layers(baseLayers, overlayLayers).addTo(map);
          
          </script>
            
    

{% endblock content%}